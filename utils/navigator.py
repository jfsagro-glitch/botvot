"""
–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –∫—É—Ä—Å–∞ - —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —É—Ä–æ–∫–∞–º–∏
"""
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from typing import Dict, Any

# –ù–∞–∑–≤–∞–Ω–∏—è —É—Ä–æ–∫–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞
LESSON_NAMES = {
    0: "–í–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π —É–∂–∏–Ω: —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –∏ –≤–æ–ø—Ä–æ—Å",
    1: "–°—Ç–∞—Ä—Ç. –ü—Ä–∞–≤–∏–ª–∞ –∫—É—Ä—Å–∞ –∏ –≤–æ–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º",
    2: "–ö–ò–†–ü–ò–ß: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å / –ø—Ä—è–º–æ–π, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π",
    3: "–û–¢–í–Å–†–¢–ö–ê: –¥–æ–∫—Ä—É—á–∏–≤–∞—é—â–∏–π –≤–æ–ø—Ä–æ—Å / —É—Ç–æ—á–Ω—è—é—â–∏–π",
    4: "–ù–û–ñ: —Ä–µ–∂—É—â–∏–π –≤–æ–ø—Ä–æ—Å / –ø—Ä–µ–ø–∞—Ä–∏—Ä—É–µ–º, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º",
    5: "–ü–ï–†–û: ¬´–ø–æ–≥–ª–∞–∂–∏–≤–∞—é—â–∏–π¬ª –≤–æ–ø—Ä–æ—Å / —Å –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–º, —Å–æ–≤–µ—Ç–æ–º, –Ω–∞ –±–ª–∏–∑–∫—É—é —Ç–µ–º—É",
    6: "–õ–ï–ö–ê–õ–û: —Ñ–∞–Ω—Ç–∞–∑–∏—è, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞",
    7: "–î–µ–Ω—å —Ç–∏—à–∏–Ω—ã. –ò–≥—Ä–∞ ¬´–ù–µ –≤–æ–ø—Ä–æ—Å¬ª",
    8: "–°–¢–†–ï–õ–ê (–®–ò–õ–û): –∫–æ–ª—é—â–∏–π –≤–æ–ø—Ä–æ—Å / –ø—Ä–æ–≤–æ–∫–∞—Ü–∏—è",
    9: "–ö–†–Æ–ß–û–ö: –≤–æ–ø—Ä–æ—Å —Ü–µ–ø–ª—è—é—â–∏–π, –≥–æ—Ç–æ–≤—è—â–∏–π –∫ –∫–æ–ª—é—â–µ–º—É",
    10: "–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ: –≤—ã–±–∏—Ä–∞–µ–º –∫—É—Ä—Å, —Å—Ç—Ä–æ–∏–º –º–∞—Ä—à—Ä—É—Ç",
    11: "–í–û–ü–†–û–°–Å–†–§–ò–ù–ì: –º–µ—Ç–æ–¥–∏–∫–∞ —Ü–µ–ø–ª—è–Ω–∏—è –∏ –≤—è–∑–∞–Ω–∏—è",
    12: "–ò—Ç–æ–≥–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è: –º–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω",
    13: "–°–ª—É—à–∞—Ç—å: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–ª—É—à–∞–Ω–∏—è",
    14: "–ü—Ä–∏–∑–Ω–∞–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ª—É—à–∞–Ω–∏—è",
    15: "–î–µ–Ω—å —Ç–∏—à–∏–Ω—ã 2. 36 –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤",
    16: "–ê–∫—Ç–∏–≤–Ω–æ–µ —Å–ª—É—à–∞–Ω–∏–µ. –°–ª–æ–≤–µ—Å–Ω—ã–µ –ø—Ä–∏—ë–º—ã",
    17: "–ö–∞–∫ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å –ø—É—Å—Ç—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã",
    18: "–û —á—ë–º –ø—É—Å—Ç—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã. –ß–µ—Ä–Ω–æ-–±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏",
    19: "–°–º—ã—Å–ª–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏ –æ–±—â–µ–Ω–∏—è",
    20: "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –æ–±—â–µ–Ω–∏—è",
    21: "–¶–µ–ª–∏ –¥–∏–∞–ª–æ–≥–æ–≤",
    22: "–î–µ–Ω—å —Ç–∏—à–∏–Ω—ã 3. –¢–µ–ª–µ–ø–∞—Ç",
    23: "–ö–∞–∫ —Ä–∞–∑–≤–∏—Ç—å –±–µ—Å–µ–¥—É: –ø—Ä–∏—ë–º—ã",
    24: "–í–µ—Å—ã (–ë–∞–ª–∞–Ω—Å –ì–æ–≤–æ—Ä–µ–Ω–∏—è –∏ –°–ª—É—à–∞–Ω–∏—è)",
    25: "–ë–∞–ª–∞–Ω—Å –ß–°–í",
    26: "–ë–∞–ª–∞–Ω—Å –ß–°–í —á–∞—Å—Ç—å 2",
    27: "–ë–∞–ª–∞–Ω—Å –ß–°–í —á–∞—Å—Ç—å 3",
    28: "–î–µ–Ω—å —Ç–∏—à–∏–Ω—ã 3",
    29: "–ë–∞–ª–∞–Ω—Å –ß–°–í –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ",
    30: "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫—É—Ä—Å–∞"
}


def create_navigator_keyboard(available_lessons: Dict[int, Dict[str, Any]], current_day: int = None) -> InlineKeyboardMarkup:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞ –∫—É—Ä—Å–∞.
    
    Args:
        available_lessons: –°–ª–æ–≤–∞—Ä—å —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —É—Ä–æ–∫–∞–º–∏ {day: lesson_data}
        current_day: –¢–µ–∫—É—â–∏–π –¥–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è)
    
    Returns:
        InlineKeyboardMarkup —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞
    """
    buttons = []
    row = []
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—Ä–æ–∫–∏ –ø–æ –Ω–æ–º–µ—Ä—É –¥–Ω—è
    sorted_days = sorted([int(k) for k in available_lessons.keys() if k.isdigit()])
    
    for day in sorted_days:
        lesson_data = available_lessons.get(str(day))
        if not lesson_data:
            continue
        
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ –∏–∑ LESSON_NAMES –∏–ª–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö —É—Ä–æ–∫–∞
        short_name = LESSON_NAMES.get(day)
        if not short_name:
            # –ï—Å–ª–∏ –Ω–µ—Ç –≤ LESSON_NAMES, –±–µ—Ä–µ–º –∏–∑ –¥–∞–Ω–Ω—ã—Ö —É—Ä–æ–∫–∞
            title = lesson_data.get("title", f"–î–µ–Ω—å {day}")
            # –£–ø—Ä–æ—â–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∫–Ω–æ–ø–∫–∏ (—É–±–∏—Ä–∞–µ–º "–î–µ–Ω—å X - ")
            if title.startswith(f"–î–µ–Ω—å {day}"):
                short_name = title.replace(f"–î–µ–Ω—å {day} - ", "").replace(f"–î–µ–Ω—å {day}", "").strip()
            else:
                short_name = title
        
        # –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ (–º–∞–∫—Å–∏–º—É–º 35 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è 2 –∫–Ω–æ–ø–æ–∫ –≤ —Ä—è–¥)
        if len(short_name) > 35:
            short_name = short_name[:32] + "..."
        
        # –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞
        if current_day is not None and day == current_day:
            button_text = f"üìç {day}. {short_name}"
        else:
            button_text = f"{day}. {short_name}"
        
        row.append(InlineKeyboardButton(
            text=button_text,
            callback_data=f"navigator:lesson:{day}"
        ))
        
        # –ü–æ 2 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥ (—Ç–∞–∫ –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω—ã–º–∏)
        if len(row) == 2:
            buttons.append(row)
            row = []
    
    # –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–Ω–æ–ø–∫–∏
    if row:
        buttons.append(row)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ó–∞–∫—Ä—ã—Ç—å" –≤ –∫–æ–Ω—Ü–µ
    buttons.append([
        InlineKeyboardButton(
            text="‚ùå –ó–∞–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä",
            callback_data="navigator:close"
        )
    ])
    
    return InlineKeyboardMarkup(inline_keyboard=buttons)


def format_navigator_message() -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞."""
    return (
        "üß≠ <b>–ù–ê–í–ò–ì–ê–¢–û–† –ö–£–†–°–ê</b>\n"
        "üìê (–∫–æ–º–ø–∞—Å/–∞—Å—Ç—Ä–æ–ª—è–±–∏—è)\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:\n\n"
        "üìç ‚Äî –≤–∞—à —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫"
    )

