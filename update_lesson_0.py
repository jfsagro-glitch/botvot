"""
Обновление урока 0:
1. Удалить первую часть текста про "Спасибо за ваши вопросы..."
2. Оставить только intro_text
3. Подготовить текст для отправки после задания с форматированием
"""
import json
import sys
from pathlib import Path

# Ensure stdout can handle UTF-8
if sys.stdout.encoding != 'utf-8':
    sys.stdout.reconfigure(encoding='utf-8')

lessons_file = Path(__file__).parent / "data" / "lessons.json"

def update_lesson_0():
    """Обновить урок 0 согласно требованиям."""
    if not lessons_file.exists():
        print(f"❌ Файл уроков не найден: {lessons_file}")
        return

    try:
        data = json.loads(lessons_file.read_text(encoding='utf-8'))
        
        # Обновляем текст урока 0 - удаляем первую часть
        if '0' in data:
            # Удаляем весь старый текст, оставляем только intro_text
            data['0']['text'] = ""
            
            # Текст для отправки после задания (будет использоваться в коде бота)
            follow_up_text = (
                "Теперь предлагаю вам взглянуть на свои вопросы с новой точки зрения, даже нескольких.\n\n"
                "❓1️⃣ С точки зрения подсознания. Спросите себя:\n\n"
                "• Почему именно он?\n"
                "• На какие ваши внутренние запросы он отвечает?\n"
                "• Что он даёт вам понять, ещё не осознанное, что просится наружу?\n\n"
                "❓2️⃣ С точки зрения разума. Чего вы хотели им: достичь?\n\n"
                "• Удивить собеседника?\n"
                "• Открыть для себя лично что-то важное?\n"
                "• Или просто спросили то, что первым пришло в голову?\n\n"
                "Это покажет вам паттерн вашего поведения: на что вы ориентируетесь в задавании вопросов инстинктивно, на автомате.\n\n"
                "❓3️⃣ С точки зрения будущего. Представьте, что этот вопрос — самый главный в вашей жизни. Сейчас вы реально можете получить на него полный исчерпывающий ответ, который может вывести вас в новую эру своей жизни.\n\n"
                "• Что спросили бы тогда?\n\n"
                "Возможно, вы уже сейчас заметите, что руководствуетесь в вопросах совсем не главной своей линией. Совсем не тем, что составляет вашу суть и цель. А просто «ведётесь» на социальные и другие шаблоны вроде таких: «надо задать самый оригинальный вопрос» или «надо спросить то, что никто не спрашивал». Но будет ли это важно для вас и вашего пути? Или для собеседника?\n\n"
                "В итоге, когда мир даёт нам шанс задать главный вопрос жизни — мы оказываемся не готовы к этому. Более того, мы не можем двигаться к стратегической цели, пока у нас нет формулировки этого главного вопроса.\n\n"
                "А может быть, после размышлений у вас изменится и собеседник?\n"
                "Если готовы поделиться ответами и наблюдениями — пишите в комментариях.\n"
                "Если нет — проживите внутри и ответьте честно себе самому."
            )
            
            # Сохраняем текст для последующей отправки в специальном поле
            data['0']['follow_up_text'] = follow_up_text
            
            print("✅ Урок 0 обновлен:")
            print(f"   - Удален текст про 'Спасибо за ваши вопросы...'")
            print(f"   - Добавлен follow_up_text для отправки после задания")
        
        lessons_file.write_text(json.dumps(data, ensure_ascii=False, indent=2), encoding='utf-8')
        print(f"\n✅ Изменения сохранены в {lessons_file}")

    except json.JSONDecodeError as e:
        print(f"❌ Ошибка при чтении JSON файла: {e}")
    except Exception as e:
        print(f"❌ Произошла ошибка: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    update_lesson_0()

