# Инструкция по парсингу канала и созданию уроков

## Общая схема

```
TELEGRAM-КАНАЛ (@StartNowAI_bot)
        ↓
Парсинг всех сообщений
        ↓
Группировка по календарным дням
        ↓
Ручная / полуавтоматическая чистка
        ↓
Маппинг в ДНИ КУРСА (Day 1–30)
        ↓
JSON структура (lessons.json)
        ↓
Telegram course bot (авторассылка)
```

## Шаг 1: Установка зависимостей

```bash
pip install telethon
```

## Шаг 2: Получение API ключей

1. Перейдите на https://my.telegram.org/
2. Войдите с вашим номером телефона
3. Перейдите в раздел "API development tools"
4. Создайте приложение и получите:
   - `api_id` (число)
   - `api_hash` (строка)

## Шаг 3: Парсинг канала

Запустите скрипт парсинга:

```bash
python scripts/parse_channel.py
```

Скрипт попросит ввести:
- API ID
- API Hash
- Username канала (например, `@StartNowAI_bot`)

**Результат:**
- `data/raw_channel.json` - все сообщения из канала
- `data/by_days.json` - сообщения, сгруппированные по дням

## Шаг 4: Создание маппинга дней

Создайте файл `data/days_mapping.json` со структурой:

```json
{
  "1": ["2023-11-01"],
  "2": ["2023-11-02", "2023-11-03"],
  "3": ["2023-11-04"],
  ...
  "30": ["2023-12-01"]
}
```

Где:
- Ключ - день курса (1-30)
- Значение - список дат из канала, которые относятся к этому дню

**Пример:** Если день 2 курса состоит из сообщений за 2 и 3 ноября, укажите оба дня.

## Шаг 5: Сборка структуры уроков

После создания маппинга запустите:

```bash
python scripts/build_lessons.py
```

**Результат:**
- `data/lessons.json` - финальная структура уроков

## Шаг 6: Заполнение заданий

Откройте `data/lessons.json` и заполните для каждого урока:

- `task` - общее задание
- `task_basic` - задание для базового тарифа
- `task_feedback` - задание для тарифа с обратной связью

Также можно установить:
- `silent: true` - для дней тишины (урок не отправляется)

## Шаг 7: Перезапуск бота

После создания `lessons.json` перезапустите курс-бот:

```bash
python -m bots.course_bot
```

## Формат lessons.json

```json
{
  "1": {
    "title": "День 1 - Название",
    "text": "Текст урока...",
    "media": [
      {
        "type": "photo",
        "file_id": null,
        "path": "media/day1_1.jpg"
      }
    ],
    "task": "Общее задание",
    "task_basic": "Задание для базового тарифа",
    "task_feedback": "Задание для тарифа с обратной связью",
    "buttons": ["submit_task", "ask_question", "discussion"],
    "silent": false
  }
}
```

## Важные моменты

1. **Медиа файлы:** После парсинга медиа сохраняются в папку `media/`. Убедитесь, что пути в JSON корректны.

2. **Дни тишины:** Установите `"silent": true` для дней, когда урок не должен отправляться.

3. **Задания по тарифам:** Используйте `task_basic` и `task_feedback` для разных заданий в зависимости от тарифа.

4. **Автоматическая отправка:** После настройки бот будет автоматически отправлять уроки пользователям 1 раз в день.

## Проверка работы

1. Убедитесь, что файл `data/lessons.json` существует
2. Проверьте, что в нем есть уроки для дней 1-30
3. Запустите курс-бот
4. Проверьте логи - должны быть сообщения о загрузке уроков

